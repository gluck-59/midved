# Пользователи (User)

## Назначение
- **Цель** Управлять входом пользователей и предоставлять контекст текущего пользователя для моделей.

## Архитектура
- **Контроллер** `application/controllers/Login.php` обрабатывает авторизацию (`/login`).
- **Модель** `application/models/UserModel.php` реализует регистрацию, аутентификацию и получение текущего пользователя.
- **Связанные сущности** все основные модели (`CustomerModel`, `EquipmentModel`, `RequestModel`, `ReportModel`) используют `UserModel::getCurrentUser()` для фильтрации данных.

## Структура данных
- **Таблица `users`** (см. `sql.sql`):
  - `id` — первичный ключ.
  - `username`, `password` (хранится в виде хеша `password_hash`).
  - Уникальный индекс по логину.

## Поток аутентификации
- **Вход** `Login::index()` получает данные формы, вызывает `UserModel::isAuth()`.
- **Проверка** `UserModel::auth()` ищет пользователя по имени и сверяет пароль с помощью `password_verify()`.
- **Сессия** при успешном входе устанавливается `$_SESSION['user_id']`.
<!--- **Регистрация** `UserModel::register()` создаёт пользователя (используется вручную/для разработки). -->

## Бизнес-правила
- **Роли** пока отсутствуют (`@TODO` в коде), все пользователи обладают одинаковыми правами.
- **Фильтрация** данные клиентов, оборудования, заявок и отчетов ограничиваются `creator = currentUser.id`.
- **Безопасность** пароли ре-хешируются при необходимости (`password_needs_rehash`).

## Расширение функциональности
- **Роли и права** добавить столбцы/таблицы для разграничения доступа.
- **Восстановление пароля** потребует новых маршрутов и полей.
- **Аудит** фиксировать входы, действия и IP.

## Диагностика и отладка
- **Сессии** проверяй `$_SESSION['user_id']` и вызовы `UserModel::auth()`.
- **SQL** логируй выборки при проблемах с входом.
- **Пароли** убедись, что `password_hash` и `password_verify` используют совместимые алгоритмы.
