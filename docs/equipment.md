# Оборудование (Equipment)

## Назначение
- **Цель** Зафиксировать характеристики оборудования клиентов, на основе которых создаются заявки и платежи.

## Архитектура
- **Контроллер** `application/controllers/Equipment.php` обрабатывает страницы `/equipment`, AJAX-запросы `/equipment/save`, `/equipment/delete`, `/equipment/getEquipmentByCustomerId`.
- **Модель** `application/models/EquipmentModel.php` выполняет CRUD-операции и фильтрует записи по текущему пользователю.
- **Представление** `application/views/equipment.php` визуализирует список оборудования и управляет вызовами модальных окон.
- **JavaScript** `application/js/script.js` (`#saveEquipment`, `.deleteEquipment`, автоподгрузка списка клиентов) инициирует AJAX-операции.
- **Модальные окна** `application/views/modals.php` (`#modal-equipment`) предоставляют UI для ввода деталей.

## Структура данных
- **Таблица `equipment`** хранит данные об оборудовании:
  - `id` — первичный ключ.
  - `customer_id` — FK на `customer.id`, определяет владельца.
  - `name` — название оборудования.
  - `mark`, `serial` — атрибуты модели/серийника.
  - `city`, `address` — местоположение.
  - `notes` — дополнительная информация.
- **Связанная сущность** `customer` управляет владельцем, `request` и `payment` опосредованно связаны через `equipment_id`.

## UI-потоки
- **Список** `application/views/equipment.php` выводит таблицу с названием, клиентом и адресом; пустой список сопровождается подсказкой.
- **Создание/редактирование** кнопка «Новое оборудование» открывает модал `#modal-equipment`. Поля заполняются вручную или при редактировании через `data-*` атрибуты (`.btn-open-modal`).
- **Удаление** кнопка `.deleteEquipment` вызывает подтверждение и отправляет запрос на `/equipment/delete`.

## API и обработчики
- **GET `/equipment`** отображает страницу со списком.
- **GET `/equipment/getEquipmentByCustomerId`** возвращает JSON по выбранным `customerId`.
- **POST `/equipment/save`** создаёт (`EquipmentModel::create()`) или обновляет (`EquipmentModel::edit()`) запись.
- **POST `/equipment/delete`** удаляет запись (`EquipmentModel::delete()`).

## Бизнес-правила
- **Привязка к пользователю** `EquipmentModel::getEquipment()` фильтрует по `c.creator`, обеспечивая доступ только к оборудованию текущего пользователя.
- **Валидация** на фронтенде минимум поле `#name`; остальные поля опциональны.
- **Редактирование** заполняет модал значениями атрибутов через `data-*`.
- **Удаление** каскадно удаляет связанные `document`, `request`, `payment` благодаря FK.

## Требования к базе данных
- **Связи**
  - `equipment.customer_id` → `customer.id` (ON DELETE CASCADE, ON UPDATE CASCADE).
  - Дополнительные FK: `document.equipment_id`, `request.equipment_id`.
- **Индексы** `equip-cust` ускоряет выборку по клиенту.

## Расширение функциональности
- **Дополнительные поля** (например, дата установки, статус обслуживания) требуют расширения формы и SQL.
- **Фильтрация списка** через дополнительные параметры `getEquipment()`.
- **Документы** интеграция с `DocumentModel` для загрузки файлов.

## Диагностика и отладка
- **AJAX** все операции идут через `$.post`/`$.getJSON`; проверяй консоль браузера на ошибки.
- **Ответы** `/equipment/save` возвращает ID (>0), `/equipment/delete` — `1` при успехе.
- **Повторное чтение** после операции осуществляется редиректом на `/equipment`.
